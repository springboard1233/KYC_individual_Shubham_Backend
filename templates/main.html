<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Powered KYC</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      color: black;
      background-color: white;/*#bdb9b9*/
    }

    /* Header */
    header {
      color: white;
      background-color:black;
      padding: 8px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }


    .header-buttons {
      display: flex;
      gap: 15px;
    }

    .header-buttons button {
      background-color: #7a6e4a;/*#78744a*/
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .header-buttons button:hover {
      background-color: #eb9210;
    }

    /* Hero Section */
    /*.hero {
      position: relative;
      height: 400px;
      /*background: url('{{ url_for("static", filename="hero.jpg") }}') no-repeat center center/cover;*/

      /*background-image: url("C:/Users/HP/Documents/try/static/hero.png");
      display: flex;
      justify-content: center;
      align-items: center;
    } */
    .hero {
      position: relative;
      height: 350px;
      padding: 10px;
      /*background: url("{{ url_for('static', filename='Kyc.png') }}") no-repeat center center;*/
      background-color: #dcd1d1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .hero-text {
      font-size: 50px;
      font-weight: bold;
      color: black;
      /*background: rgba(0, 0, 0, 0.28);*/
      padding: 20px 40px;
      border-radius: 8px;
      text-align: center;
    }

    /* Footer */
    footer {
      /*background-color: #FF9800;  /*#062d95;*/
      background: linear-gradient(to right, #df3838, #5454cf);
      /*background-color: #5f6fc4;/*#78744a*/               /*#FF5722*/
      padding: 40px 20px;
      text-align: center;
    }

    footer h2 {
      color: white;
      margin-bottom: 30px;
      font-size: 22px;
      font-weight: bold;
    }

    .services {
      display: flex;
      justify-content: center;
      gap: 100px;
      flex-wrap: wrap;
    }

    .service-box {
      /*background-color: rgba(0, 0, 0, 0.28);*/
      /*background-color: #FF9800;*/
      border-width: 2px;
      color: #795548;
      background-color: white;
      padding: 25px;
      flex: 1;
      max-width: 250px;
      border-radius: 8px;
      font-size: 20px;
    }

    /* Modal */
    .modal {
      display: none; /* hidden initially */
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: #fff;
      color: #000;
      width: 35%;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      position: relative;
      box-shadow: 0px 4px 20px rgba(0,0,0,0.5);
    }

    .modal-content h2 {
      margin-bottom: 20px;
      color:  #78744a;
    }

    .modal-content input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    .modal-content button {
      background-color:  #78744a;
      color: white;
      border: none;
      padding: 10px 20px;
      margin-top: 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    .modal-content button:hover {
      background-color: #0f5ad3;
    }

    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
      color: #FF9800;
      background: none;
      border: none;
    }

    .error { color: red; margin-top: 10px; }
    .success { color: green; margin-top: 10px; }

    @media(max-width:768px){
      .modal-content { width: 80%; }
      .hero-text { font-size: 32px; padding: 15px 20px; }
      .service-box { max-width: 200px; font-size: 16px; padding: 15px; }
    }



  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <h1>AI KYC</h1>
    <div class="header-buttons">
      <button onclick="openSignupForm()">Signup</button>
      <button onclick="openLoginForm()">Login</button>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">

    <div class="hero-text">
      AI POWERED KYC AND IDENTITY VERIFICATION
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <h2>OUR KEY SERVICES</h2>
    <div class="services">
      <div class="service-box">OCR EXTRACTION FEATURE</div>
      <div class="service-box">KYC VIA AI</div>
      <div class="service-box">IDENTITY VERIFICATION VIA AI</div>
    </div>
  </footer>

  <!-- Signup Modal -->
  <div class="modal" id="signupModal">
    <div class="modal-content" id="signupContent">
      <button class="modal-close" onclick="closeSignupForm()">X</button>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content" id="loginContent">
      <button class="modal-close" onclick="closeLoginForm()">X</button>
    </div>
  </div>

  <script>
    // ===== Signup Flow =====
    const signupModal = document.getElementById("signupModal");
    const signupContent = document.getElementById("signupContent");

    function openSignupForm() {
      signupModal.style.display = "flex";
      loadSignupForm();
    }
    function closeSignupForm() { signupModal.style.display = "none"; }

    /*function loadSignupForm() {
      signupContent.innerHTML = `
        <button class="modal-close" onclick="closeSignupForm()">X</button>
        <h2>Signup</h2>
        <input type="text" id="firstname" placeholder="Firstname" required>
        <input type="text" id="lastname" placeholder="Lastname" required>
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <br>
        <button onclick="submitSignup()">Sign Up</button>
        <div id="signupMsg"></div>
      `;
    }*/

    function loadSignupForm() {
  signupContent.innerHTML = `
    <button class="modal-close" onclick="closeSignupForm()">X</button>
    <h1>Signup</h1>

    <div style="position: relative; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
      <input type="text" id="firstname" placeholder="Firstname" required
             style="width: 100%; padding-right: 35px; box-sizing: border-box;">
    </div>

    <div style="position: relative; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
      <input type="text" id="lastname" placeholder="Lastname" required
             style="width: 100%; padding-right: 35px; box-sizing: border-box;">
    </div>

    <div style="position: relative; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
      <input type="email" id="email" placeholder="Email" required
             style="width: 100%; padding-right: 35px; box-sizing: border-box;">
    </div>

    <div style="position: relative; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
      <input type="password" id="password" placeholder="Password" required
             style="width: 100%; padding-right: 35px; box-sizing: border-box;">
      <i class="bi bi-eye"
         onclick="togglePassword('password', this)"
         style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
                cursor: pointer; font-size: 16px; color: #555;">
      </i>
    </div>

    <div style="position: relative; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
      <input type="password" id="confirmPassword" placeholder="Confirm Password" required
             style="width: 100%; padding-right: 35px; box-sizing: border-box;">
      <i class="bi bi-eye"
         onclick="togglePassword('confirmPassword', this)"
         style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
                cursor: pointer; font-size: 16px; color: #555;">
      </i>
    </div>

    <button onclick="submitSignup()">Sign Up</button>
    <div id="signupMsg"></div>
  `;
}



    function loadOtpForm(email) {
      signupContent.innerHTML = `
        <button class="modal-close" onclick="closeSignupForm()">X</button>
        <h2>Verify OTP</h2>
        <input type="email" id="otpEmail" value="${email}" readonly>
        <input type="text" id="otpCode" placeholder="Enter OTP">
        <br>
        <button onclick="submitOtp()">Verify OTP</button>
        <button onclick="resendOtp()">Resend OTP</button>
        <div id="otpMsg"></div>
      `;
    }

    function loadSuccessMsg() {
      signupContent.innerHTML = `
        <h2 class="success">Signup Successful!</h2>
        <button onclick="closeSignupForm()">Go to Login</button>
      `;
    }

    /*async function submitSignup() {
      const data = {
        firstname: document.getElementById("firstname").value,
        lastname: document.getElementById("lastname").value,
        email: document.getElementById("email").value,
        password: document.getElementById("password").value
      };
      try {
        const res = await fetch("/api/signup", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (res.ok) {
          document.getElementById("signupMsg").innerHTML = `<p class="success">${result.message}</p>`;
          setTimeout(() => loadOtpForm(data.email), 1500);
        } else {
          document.getElementById("signupMsg").innerHTML = `<p class="error">${result.message}</p>`;
        }
      } catch (err) {
        document.getElementById("signupMsg").innerHTML = `<p class="error">Server error</p>`;
      }
    }*/


    async function submitSignup() {
      const data = {
        firstname: document.getElementById("firstname").value,
        lastname: document.getElementById("lastname").value,
        email: document.getElementById("email").value,
        password: document.getElementById("password").value,
        confirm_password: document.getElementById("confirmPassword").value
      };

      try {
        const res = await fetch("/api/signup", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (res.ok) {
          document.getElementById("signupMsg").innerHTML = `<p class="success">${result.message}</p>`;
          setTimeout(() => loadOtpForm(data.email), 1500);
        } else {
          document.getElementById("signupMsg").innerHTML = `<p class="error">${result.message}</p>`;
        }
      } catch (err) {
        document.getElementById("signupMsg").innerHTML = `<p class="error">Server error</p>`;
      }
    }

    function togglePassword(fieldId, iconEl) {
      const input = document.getElementById(fieldId);
      if (input.type === "password") {
        input.type = "text";
        iconEl.classList.remove("bi-eye");
        iconEl.classList.add("bi-eye-slash");
      } else {
        input.type = "password";
        iconEl.classList.remove("bi-eye-slash");
        iconEl.classList.add("bi-eye");
      }
    }



    async function submitOtp() {
      const data = {
        email: document.getElementById("otpEmail").value,
        otp: document.getElementById("otpCode").value
      };
      try {
        const res = await fetch("/api/verify-otp", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (res.ok) {
          document.getElementById("otpMsg").innerHTML = `<p class="success">${result.message}</p>`;
          setTimeout(loadSuccessMsg, 1500);
        } else {
          document.getElementById("otpMsg").innerHTML = `<p class="error">${result.message}</p>`;
        }
      } catch (err) {
        document.getElementById("otpMsg").innerHTML = `<p class="error">Server error</p>`;
      }
    }

    async function resendOtp() {
      const data = { email: document.getElementById("otpEmail").value };
      try {
        const res = await fetch("/api/resend-otp", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (res.ok) {
          document.getElementById("otpMsg").innerHTML = `<p class="success">${result.message}</p>`;
        } else {
          document.getElementById("otpMsg").innerHTML = `<p class="error">${result.message}</p>`;
        }
      } catch (err) {
        document.getElementById("otpMsg").innerHTML = `<p class="error">Server error</p>`;
      }
    }

    // ===== Login Flow =====
    const loginModal = document.getElementById("loginModal");
    const loginContent = document.getElementById("loginContent");

    function openLoginForm() {
      loginModal.style.display = "flex";
      loadLoginForm();
    }
    function closeLoginForm() { loginModal.style.display = "none"; }

    /*function loadLoginForm() {
      loginContent.innerHTML = `
        <button class="modal-close" onclick="closeLoginForm()">X</button>
        <h2>Login</h2>
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <br>
        <button onclick="submitLogin()">Login</button>
        <div id="loginMsg"></div>
      `;
    }*/

    function loadLoginForm() {
  loginContent.innerHTML = `
    <button class="modal-close" onclick="closeLoginForm()">X</button>
    <h1>Login</h1>

    <input type="email" id="loginEmail" placeholder="Email" required
           style="width: 100%; box-sizing: border-box; margin-bottom: 10px;">

    <div style="position: relative; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
      <input type="password" id="loginPassword" placeholder="Password" required
             style="width: 100%; padding-right: 35px; box-sizing: border-box;">
      <span class="bi bi-eye" onclick="togglePassword('loginPassword', this)"
            style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
                   cursor: pointer; font-size: 14px; color: #555;">

      </span>
    </div>

    <button onclick="submitLogin()">Login</button>
    <div id="loginMsg"></div>
  `;
}



    function loadLoginOtpForm(email) {
      loginContent.innerHTML = `
        <button class="modal-close" onclick="closeLoginForm()">X</button>
        <h2>OTP Verification</h2>
        <p>OTP sent to email. Please verify.</p>
        <input type="email" id="loginOtpEmail" value="${email}" readonly>
        <input type="text" id="loginOtpCode" placeholder="Enter OTP">
        <br>
        <button onclick="submitLoginOtp()">Verify OTP</button>
        <div id="loginOtpMsg"></div>
      `;
    }

    function loadResendLoginOtpForm(email) {
  loginContent.innerHTML = `
    <button class="modal-close" onclick="closeLoginForm()">X</button>
    <h2>OTP Verification</h2>
    <p class="error">Invalid or expired OTP..</p>
    <input type="email" id="loginOtpEmail" value="${email}" readonly>
    <input type="text" id="loginOtpCode" placeholder="Enter New OTP">
    <br>
    <button onclick="submitLoginOtp()">Verify OTP</button>
    <button onclick="resendLoginOtp()">Resend OTP</button>
    <div id="loginOtpMsg"></div>
  `;
}

    async function submitLogin() {
      const data = {
        email: document.getElementById("loginEmail").value,
        password: document.getElementById("loginPassword").value
      };
      try {
        const res = await fetch("/api/login", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if (res.status === 401) {
          document.getElementById("loginMsg").innerHTML = `<p class="error">${result.message}</p>`;
        } else if (res.ok) {
          document.getElementById("loginMsg").innerHTML = `<p class="success">${result.message}</p>`;
          setTimeout(() => loadLoginOtpForm(data.email), 1500);
        }
      } catch (err) {
        document.getElementById("loginMsg").innerHTML = `<p class="error">Server error</p>`;
      }
    }

    async function submitLoginOtp() {
    const data = {
        email: document.getElementById("loginOtpEmail").value,
        otp: document.getElementById("loginOtpCode").value
    };

    try {
        const res = await fetch("/api/login-verify-otp", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        const result = await res.json();

        if (res.ok) {
            // Store token and role
            localStorage.setItem("token", result.token);
            localStorage.setItem("role", result.role);

            // Show success message
            loginContent.innerHTML = `<h2 class="success">${result.message}</h2>`;

            // Redirect based on role (customize as needed)
            setTimeout(() => {
                if (result.role === "admin") {
                    window.location.href = "/admin-dashboard";
                } else if (result.role === "user") {
                    window.location.href = "/home";
                } else {
                    window.location.href = "/home"; // fallback
                }
            }, 1500);
        } else {
            // Invalid or expired OTP: show resend form
            loginContent.innerHTML = `<p class="error">${result.message}</p>`;
            loadResendLoginOtpForm(data.email);
        }
    } catch (err) {
        loginContent.innerHTML = `<p class="error">Server error. Please try again later.</p>`;
        console.error("Login OTP error:", err);
    }
}


   /* async function resendLoginOtp() {
      const email = document.getElementById("resendLoginEmail").value;
      try {
        const res = await fetch("/api/resend-login-otp", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email })
        });
        const result = await res.json();
        if (res.status === 400) {
          document.getElementById("resendLoginMsg").innerHTML = `<p class="error">${result.message}</p>`;
        } else if (res.ok) {
          document.getElementById("resendLoginMsg").innerHTML = `<p class="success">${result.message}</p>`;
          //setTimeout(() => window.location.href = "/home", 1500);
        }
      } catch (err) {
        document.getElementById("resendLoginMsg").innerHTML = `<p class="error">Server error</p>`;
      }
    } */

    async function resendLoginOtp() {
  const email = document.getElementById("loginOtpEmail").value;
  try {
    const res = await fetch("/api/resend-login-otp", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });
    const result = await res.json();
    if (res.status === 400) {
      document.getElementById("loginOtpMsg").innerHTML = `<p class="error">${result.message}</p>`;
    } else if (res.ok) {
      document.getElementById("loginOtpMsg").innerHTML = `<p class="success">${result.message}. Please enter the new OTP.</p>`;
    }
  } catch (err) {
    document.getElementById("loginOtpMsg").innerHTML = `<p class="error">Server error</p>`;
  }
}






    // Close modals when clicking outside content
   /* window.onclick = function(event) {
      if (event.target == signupModal) closeSignupForm();
      if (event.target == loginModal) closeLoginForm();
    }*/
  </script>

</body>
</html>
